import{z as w,m as S,r as k,j as e,e as v,f as D,F as u,ao as Q,B as p,L as b,aO as U,aP as V,t as P,x as W,aa as h,ab as x,ac as m,w as z,I as X,aI as _,aJ as J,K,ad as Y,ae as Z,aQ as ee,aM as se,ak as re,al as ne,am as te,ah as ae,an as le}from"./vendor-oO_J9ypD.js";import{S as ce,H as g,g as ie,A as T,F as M,f as E,a as R,c as I,L as $,e as A,M as de}from"./index-WvogOZQZ.js";function F(s,r,n){const l=w(()=>ce.Index(s,g.Order.Get.order));return ie(l,()=>(r?T:g).Order.Get.Order(s),{...n,useMemory:!0})}const oe=S({body:{...M,justifyContent:"space-between"}});function ue({OrderId:s,Refresh:r,Admin:n,ParentLog:l}){const t=w(()=>l.With("Append")),i=oe(),[a,d]=k.useState(),{dispatch:o,dispatchToast:c}=E(t),{run:j,loading:N}=(n?T:g).Order.Post.useAppend({manual:!0,onError(O,y){o({Message:"Failed Append Comment",Request:y,Error:O})},onSuccess(){c(e.jsx(v,{children:e.jsx(D,{children:"Comment Appended"})}),{intent:"success"}),r(),d("")}}),{data:C,mutate:B}=F(s,n),{run:q,loading:L}=(n?T:g).Order.Post.useCancel({manual:!0,onError(O,y){o({Message:`Failed ${n?"Close":"Cancel"} Order`,Request:y,Error:O})},onSuccess(O){c(e.jsx(v,{children:e.jsxs(D,{children:["Order ",n?"Closed":"Cancelled"]})}),{intent:"success"}),B(y=>({...y,Status:O}))}});switch(C?.Status){case"Cancelled":case"Finished":return null}return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Append",size:"large",children:e.jsx(Q,{value:a,onChange:(O,y)=>d(y.value),maxLength:1e3})}),e.jsxs("div",{className:i.body,children:[!(C?.Status==="Finished"||C?.Status==="Returning")&&e.jsxs(p,{onClick:()=>q(s,a),disabled:L,children:[n?"Force Close":C?.Status==="Shipping"?"Ask Return":"Cancel Order"," with Reason"]}),e.jsx(p,{appearance:"primary",onClick:()=>j(s,a),disabled:N,children:"Add Comment"})]})]})}function xe({OrderId:s,Admin:r,ParentLog:n}){const l=w(()=>n.With("Comment")),{data:t,refresh:i}=g.Order.Get.useCmts(s,l,r);return e.jsxs(e.Fragment,{children:[e.jsx(u,{label:"Comment",size:"large",children:t?.length===0?e.jsx(b,{children:"No Comment"}):t?.map((a,d)=>e.jsxs("div",{children:[e.jsxs(U,{children:[a.User," ",a.Time.toLocaleString()]}),e.jsx("br",{}),e.jsx(V,{children:a.Content})]},d))}),e.jsx(ue,{OrderId:s,Refresh:i,ParentLog:l,Admin:r})]})}const he=S({flex:M,box:{...R,flexBasis:"50%",rowGap:P.spacingVerticalM}});function je({OrderId:s,Admin:r,ParentLog:n}){const l=w(()=>n.With("Info")),t=he(),{Nav:i}=I(),{data:a}=F(s,r,{onError(j){i(r?"Admin/Order":"History"),n.error(j)}}),{data:d}=W(()=>T.User.Get.OrderUser(s),{manual:!r,onError:l.error}),{data:o}=g.User.Get.useMe(l,r),c=r?d:o;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:t.flex,children:[e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Name",size:"large",children:e.jsxs(b,{children:[c?.Surname,", ",c?.Forename]})})}),e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Phone",size:"large",children:e.jsx(b,{children:c?.Phone})})})]}),e.jsxs("div",{className:t.flex,children:[e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Order Date",size:"large",children:e.jsx(b,{children:a?.CreateAt.toLocaleDateString()})})}),e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Status",size:"large",children:e.jsx(b,{children:a?.Status})})})]}),e.jsxs("div",{className:t.flex,children:[e.jsx("div",{className:t.box,children:e.jsx(u,{label:"E-Mail",size:"large",children:e.jsx(b,{children:c?.EMail})})}),!r&&e.jsx("div",{className:t.box,children:e.jsx(u,{label:"Tracking Number",size:"large",children:e.jsx(b,{children:a?.TrackingNumber})})})]}),e.jsx(u,{label:"Address",size:"large",children:e.jsx(b,{children:c?.Address})})]})}const me=S({body:{...R,alignItems:"flex-start"}}),pe=new $("Admin","Order","Detail","Action");function ge({OrderId:s}){const r=me(),{dispatch:n,dispatchToast:l}=E(pe),{data:t,mutate:i}=F(s,!0),{run:a}=T.Order.Post.useAccept({manual:!0,onError(d,o){n({Message:"Failed Accept Order",Request:o,Error:d})},onSuccess(){l(e.jsx(v,{children:e.jsx(D,{children:"Order Accepted"})}),{intent:"success"}),i(d=>({...d,Status:"Processing"}))}});switch(t?.Status){case"Processing":case"Shipping":case"Finished":case"Cancelled":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsx("div",{className:r.body,children:t?.Status==="Pending"&&e.jsx(p,{appearance:"subtle",onClick:()=>a(s),children:"Accept Order"})})})}const G=S({ten:{flexBasis:"10%",flexGrow:0}}),Ce=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Name"})},renderCell(s){return e.jsx(m,{children:s.Name})}}),h({columnId:"Type",renderHeaderCell(){return e.jsx(x,{children:"Type"})},renderCell(s){return e.jsx(m,{children:Object.entries(s.Type).reduce((r,n)=>`${r} ${n[0]} : ${n[1]} ;`,"")})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:G().ten,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:G().ten,children:s.Quantity})}})];function be({Items:s}){return e.jsx(u,{label:"Required Products",size:"large",children:e.jsx(A,{Items:s,Columns:Ce})})}const fe=new $("Admin","Order","Detail","Shipment");function ye({OrderId:s}){const[r,{setTrue:n,setFalse:l}]=z(),{dispatch:t,dispatchToast:i}=E(fe),{data:a,mutate:d}=F(s,!0),[o,c]=k.useState("");k.useEffect(()=>{a?.TrackingNumber&&c(a?.TrackingNumber)},[a]);const{run:j}=T.Order.Post.useShip({manual:!0,onError(N,C){t({Message:"Failed Update Tracking Number",Request:C,Error:N})},onSuccess(){i(e.jsx(v,{children:e.jsx(D,{children:"Tracking Number Updated"})}),{intent:"success"}),l(),d(N=>({...N,TrackingNumber:o}))}});return e.jsx(u,{label:"Shipment",size:"large",children:e.jsx(X,{value:o,disabled:!r,appearance:"underline",onChange:(N,C)=>c(C.value),placeholder:"Fill in this field to ship the order.",contentAfter:r?e.jsx(p,{appearance:"subtle",icon:e.jsx(_,{}),onClick:()=>j(s,o)}):e.jsx(p,{appearance:"subtle",icon:e.jsx(J,{}),onClick:n})})})}const Se=S({body:{...R,alignItems:"flex-start"}}),Ne=new $("History","Detail","Action");function Oe({OrderId:s}){const r=Se(),{Reload:n}=I(),{data:l,mutate:t}=F(s),{dispatch:i,dispatchToast:a}=E(Ne),{run:d}=g.Order.Post.useReceived({manual:!0,onError(c,j){i({Message:"Failed Mark Receive",Request:j,Error:c})},onSuccess(){a(e.jsx(v,{children:e.jsx(D,{children:"Order Received"})}),{intent:"success"}),t(c=>({...c,Status:"Finished"}))}}),{run:o}=g.Order.Delete.useDelete({manual:!0,onError(c,j){i({Message:"Failed Delete Order",Request:j,Error:c})},onSuccess(){a(e.jsx(v,{children:e.jsx(D,{children:"Order Deleted"})}),{intent:"success"}),n("History")}});switch(l?.Status){case"Pending":case"Processing":case"Finished":case"Returning":return null}return e.jsx(u,{label:"Action",size:"large",children:e.jsxs("div",{className:r.body,children:[l?.Status==="Cancelled"&&e.jsx(p,{appearance:"subtle",onClick:()=>o(s),children:"Delete Order"}),l?.Status==="Shipping"&&e.jsx(p,{appearance:"subtle",onClick:()=>d(s),children:"I Received Order"})]})})}const H=S({body:{...R,rowGap:P.spacingVerticalL,paddingBottom:P.spacingVerticalXXL},prod:{...R,alignItems:"flex-start",justifyContent:"center"},qua:{flexBasis:"10%",flexGrow:0,justifyContent:"center"}}),ve=[h({columnId:"Product",renderHeaderCell(){return e.jsx(x,{children:"Product Name & Types"})},renderCell(s){return e.jsxs(m,{className:H().prod,children:[e.jsx(K,{href:`/Product/${s.ProdId}`,appearance:"subtle",children:e.jsx(Y,{children:s.Name})}),e.jsx(Z,{children:Object.values(s.Type).reduce((r,n)=>`${r} ${n},`,"")})]})}}),h({columnId:"Quantity",renderHeaderCell(){return e.jsx(x,{className:H().qua,children:"Quantity"})},renderCell(s){return e.jsx(m,{className:H().qua,children:s.Quantity})}})];function De({OrderId:s,Admin:r,ParentLog:n}){const l=H(),{data:t}=g.Order.Get.useItems(s,n,r);return e.jsxs("div",{className:l.body,children:[e.jsx(je,{OrderId:s,Admin:r,ParentLog:n}),r?e.jsxs(e.Fragment,{children:[e.jsx(be,{Items:t}),e.jsx(ye,{OrderId:s})]}):e.jsx(A,{Items:t,Columns:[de(44,n,i=>i.Cover),...ve]}),e.jsx(xe,{OrderId:s,ParentLog:n,Admin:r}),r?e.jsx(ge,{OrderId:s}):e.jsx(Oe,{OrderId:s})]})}function Te({OrderId:s,Admin:r,ParentLog:n}){const l=w(()=>n.With("Detail")),[t,{set:i}]=z(),{Nav:a,Paths:d}=I(),o=parseInt(d.at(r?2:1));k.useEffect(()=>i(o===s),[o]);const c=k.useRef(null),[j]=ee(c);return e.jsxs(e.Fragment,{children:[e.jsx(p,{appearance:"subtle",icon:e.jsx(se,{}),onClick:()=>a(r?"Admin/Order":"History",s)}),e.jsxs(re,{open:t,position:"end",size:"medium",modalType:"alert",children:[e.jsx(ne,{children:e.jsx(te,{action:e.jsx(p,{appearance:"subtle",icon:e.jsx(ae,{}),onClick:()=>a(r?"Admin/Order":"History")}),children:"Order Detail"})}),e.jsx(le,{ref:c,children:j&&e.jsx(De,{OrderId:s,ParentLog:l,Admin:r})})]})]})}const f=S({five:{flexBasis:"5%",flexGrow:0},ten:{flexBasis:"10%",flexGrow:0},two:{flexBasis:"2.5%",flexGrow:0}}),ke=[h({columnId:"OrderId",renderHeaderCell:()=>e.jsx(x,{className:f().five,children:"Order Id"}),renderCell(s){return e.jsx(m,{className:f().five,children:s.Id})}}),h({columnId:"Products",renderHeaderCell:()=>e.jsx(x,{children:"Products"}),renderCell(s){return e.jsxs(m,{children:[s.Items[0]," ",s.Items.length>1&&`& +${s.Items.length-1}`]})}}),h({columnId:"OrderDate",renderHeaderCell:()=>e.jsx(x,{children:"Order Date"}),renderCell(s){return e.jsx(x,{children:s.OrderDate.toLocaleDateString()})}}),h({columnId:"TrackNumber",renderHeaderCell:()=>e.jsx(x,{children:"Track Number"}),renderCell(s){return e.jsx(m,{children:s.TrackNumber})}}),h({columnId:"Quantity",renderHeaderCell:()=>e.jsx(x,{className:f().ten,children:"Quantity"}),renderCell(s){return e.jsx(m,{className:f().ten,children:s.Quantity})}}),h({columnId:"Status",renderHeaderCell:()=>e.jsx(x,{className:f().ten,children:"Order State"}),renderCell(s){return e.jsx(m,{className:f().ten,children:s.Status})}})];function Fe(s){return[...ke,h({columnId:"Detail",renderHeaderCell:()=>e.jsx(x,{className:f().two,children:"Detail"}),renderCell(r){return e.jsx(m,{className:f().two,children:e.jsx(Te,{OrderId:r.Id,ParentLog:s})})}})]}export{Fe as H,Te as O};
